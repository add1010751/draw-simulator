<!DOCTYPE html>
<html lang="zh-tw">
<head>
  <meta charset="UTF-8" />
  <title>冰機模擬器</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
    h1 { text-align: center; }
    .controls { text-align: center; margin-bottom: 20px; }
    button { margin: 5px; padding: 10px 20px; font-size: 16px; }
    #result { white-space: pre-line; background: white; padding: 10px; border-radius: 10px; border: 1px solid #ccc; max-height: 300px; overflow-y: auto; }
    .progress { width: 100%; background-color: #ddd; border-radius: 5px; overflow: hidden; margin-top: 20px; }
    .progress-bar { height: 20px; background-color: #4CAF50; width: 0%; text-align: center; color: white; }
    #summary { background: white; padding: 10px; border-radius: 10px; border: 1px solid #ccc; max-height: 300px; overflow-y: auto; margin-top: 20px; }
    li { margin-bottom: 3px; }
    #recentSImages {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 8px;
      padding: 6px;
      background: white;
      border-radius: 10px;
      border: 1px solid #ccc;
      max-height: 130px;
      overflow-x: auto;
    }
    #recentSImages img {
      width: 60px;
      height: 60px;
      object-fit: contain;
      border: 1px solid #ccc;
      border-radius: 5px;
      background: #fff;
    }
	#probabilities {
      margin-top: 40px;
      padding: 10px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <h1>抽獎模擬器</h1>
  <div class="controls">
    <button onclick="draw(1)">單抽</button>
    <button onclick="draw(10)">10連抽</button>
	<button onclick="draw(30)">30連抽</button>
    <button onclick="draw(100)">100連抽</button>
	<button onclick="draw(1000)">1000連抽</button>
    <button onclick="resetAll()">🔄 重置</button>
  </div>
  <div class="progress">
    <div class="progress-bar" id="pityBar">0%</div>
  </div>
  <p>累計保底次數：<span id="pityCount">0</span></p>
  <p>總花費：<span id="totalCost">0</span> 元</p>
  <p>累積抽數：<span id="totalDraws">0</span> 次</p>

  <div id="recentSImages"></div>

  <h3>獲得道具</h2>
  <div id="result"></div>

  <h2>各獎項獲得次數統計</h2>
  <ul id="summary"></ul>
  
  <div id="probabilities">
    <h3>各個獎項機率</h3>
    <ul id="probabilitiesList"></ul>
  </div>

  <script>
    // [名稱, 機率, 稀有度, 圖片URL]
    const items = [
      ["厄瑞玻斯的哀歌武器箱", 0.0045, "S", "https://i.ibb.co/Zpw7tJsC/image.png"],
      ["厄瑞玻斯的哀歌上衣箱", 0.009, "S", "https://i.ibb.co/DfcwPGF6/image.png"],
      ["厄瑞玻斯的哀歌下衣箱", 0.009, "S", "https://i.ibb.co/PsJmP40y/image.png"],
      ["厄瑞玻斯的哀歌手套箱", 0.0165, "S", "https://i.ibb.co/SCByhnN/image.png"],
      ["厄瑞玻斯的哀歌鞋子箱", 0.0165, "S", "https://i.ibb.co/whFrrJ8D/image.png"],
      ["厄瑞玻斯的哀歌髮型箱", 0.009, "S", "https://i.ibb.co/Zp0T4vTn/image.png"],
      ["厄瑞玻斯的哀歌飾品(娃娃)箱", 0.0035, "S", "https://i.ibb.co/0jwb77cP/image.png"],
      ["厄瑞玻斯的哀歌飾品(臉上)箱", 0.0045, "S", "https://i.ibb.co/8DHmQqBM/image.png"],
      ["厄瑞玻斯的哀歌飾品(臉下)箱", 0.0035, "S", "https://i.ibb.co/pv9vCX6C/image.png"],
      ["厄瑞玻斯的哀歌飾品(下衣)箱", 0.004, "S", "https://i.ibb.co/ch1WxnY6/image.png"],
	  
      ["武器專用強化符咒Lv.10", 0.00001, "S", "https://i.ibb.co/0y8hsBRg/image.png"],
      ["防具專用強化符咒Lv.10", 0.00001, "S", "https://i.ibb.co/N2ftJCt1/image.png"],
	  
      ["聖戰士", 0.00001, "S", "https://i.ibb.co/KxhXk6WS/image.png"],
      ["犧牲", 0.00001, "S", "https://i.ibb.co/pvYZh8Jd/image.png"],
      ["勝利榮耀", 0.00001, "S", "https://i.ibb.co/k6HBrGL5/image.png"],
	  
      ["金色閃耀圍巾箱", 0.000001, "S", "https://i.ibb.co/5trrzMW/image.png"],
      ["神聖護符箱", 0.000001, "S", "https://i.ibb.co/0pd8kDdV/image.png"],
      ["阿卡恩銘刻", 0.000001, "S", "https://i.ibb.co/cSJCPmnW/image.png"],
	  
      ["燦爛的秘傳原石", 0.0001, "S", "https://i.ibb.co/spSVmYCC/image.png"],
      ["掉落率70%獎牌箱(1天)", 0.0001, "S", "https://i.ibb.co/33kdrbr/image.png"],
	  
      ["賢者的致命一擊魔法石", 0.001, "S", "https://i.ibb.co/9kBB9P5K/image.png"],
      ["賢者的極大化魔法石", 0.001, "S", "https://i.ibb.co/p61BMXRV/image.png"],
      ["賢者的動作速度魔法石", 0.001, "S", "https://i.ibb.co/RTZGGT2s/image.png"],
      ["賢者的額外傷害魔法石", 0.001, "S", "https://i.ibb.co/zVgpYpnS/image.png"],
      ["賢者的傷害減少魔法石", 0.001, "S", "https://i.ibb.co/QjKVNLG4/image.png"],
      ["賢者的HP增加魔法石", 0.001, "S", "https://i.ibb.co/1fyzLKVV/image.png"],
	  
      ["武器裝飾箱子", 0.034, "A", ""],
      ["賢者的魔法石箱(2個)", 0.010597, "A", ""],
      ["職階賦靈錄–加成效果使用券(10天)", 0.00115, "A", ""],
      ["夢幻超技能加速靈藥", 0.0325, "A", ""],
      ["夢幻貝多斯的翅膀羽毛靈藥", 0.0325, "A", ""],
      ["晉級時裝箱(15天)", 0.034, "A", ""],
      ["巨人的石蘋果", 0.02, "B", ""],
      ["超人的有機蘋果", 0.02, "B", ""],
      ["疾風的安朵美達蘋果", 0.02, "B", ""],
      ["鬥志藥水", 0.013, "B", ""],
      ["完全恢復藥水箱(100個)", 0.1, "B", ""],
      ["適應靈藥", 0.02, "B", ""],
      ["致命一擊特級魔法石", 0.01, "B", ""],
      ["動作速度特級魔法石", 0.01, "B", ""],
      ["極大化特級魔法石", 0.01, "B", ""],
      ["HP特級魔法石", 0.01, "B", ""],
      ["完全恢復藥水箱(150個)", 0.04, "B", ""],
      ["艾爾的結晶(不明)", 0.04, "C", ""],
      ["艾爾的結晶(火)", 0.04, "C", ""],
      ["艾爾的結晶(水)", 0.04, "C", ""],
      ["艾爾的結晶(風)", 0.04, "C", ""],
      ["艾爾的結晶(地)", 0.04, "C", ""],
      ["艾爾的結晶(闇)", 0.04, "C", ""],
      ["艾爾的結晶(光)", 0.04, "C", ""],
      ["火之水晶球300入箱", 0.036, "C", ""],
      ["自然之水晶球300入箱", 0.036, "C", ""],
      ["水之水晶球300入箱", 0.036, "C", ""],
      ["風之水晶球300入箱", 0.036, "C", ""],
      ["光之水晶球300入箱", 0.036, "C", ""],
      ["闇之水晶球300入箱", 0.036, "C", ""],
    ];

    const pityRates = { S: 0.10, A: 0.15, B: 0.20, C: 0.40 };
    let pity = 0;
    let pityCount = 0;
    let totalDraws = 0;
    const costPerDraw = 48;

    const stats = {};
    items.forEach(item => stats[item[0]] = 0);

    const recentSImages = [];

    function draw(times) {
      let result = "";
      for (let i = 0; i < times; i++) {
        const item = roll();

        if (item[2] === "S") {
          result += `<span style="color:red;">[${item[2]}] ${item[0]}</span>\n`;

          if (item[3]) {
            recentSImages.unshift(item[3]);
            if (recentSImages.length > 30) recentSImages.pop();
          }
        } else {
          result += `[${item[2]}] ${item[0]}\n`;
        }

        pity += pityRates[item[2]];
        stats[item[0]]++;
        totalDraws++;

        if (pity >= 100) {
          pity -= 100;
          pityCount++;
          result += `🎉【保底達成！】🎉\n`;
        }
      }

      updateProgress();
      updateStats();
      updateDisplay();
      updateRecentSImages();

      document.getElementById("result").innerHTML = result + "<br>" + document.getElementById("result").innerHTML;
    }

    function roll() {
      const rand = Math.random();
      let acc = 0;
      for (const item of items) {
        acc += item[1];
        if (rand < acc) return item;
      }
      return items[items.length - 1];
    }

    function updateProgress() {
      const bar = document.getElementById("pityBar");
      const percent = Math.min(pity, 100).toFixed(2);
      bar.style.width = percent + "%";
      bar.textContent = percent + "%";
      document.getElementById("pityCount").textContent = pityCount;
    }

    function updateStats() {
      const summary = document.getElementById("summary");
      summary.innerHTML = "";
      for (const item of items) {
        const name = item[0];
        const rarity = item[2];
        const count = stats[name];
        if (count > 0) {
          const li = document.createElement("li");
          li.textContent = `[${rarity}] ${name} × ${count}`;
          summary.appendChild(li);
        }
      }
    }

    function updateDisplay() {
      document.getElementById("totalCost").textContent = totalDraws * costPerDraw;
      document.getElementById("totalDraws").textContent = totalDraws;
    }

    function updateRecentSImages() {
      const container = document.getElementById("recentSImages");
      container.innerHTML = "";
      recentSImages.forEach(url => {
        const img = document.createElement("img");
        img.src = url;
        container.appendChild(img);
      });
    }

    function resetAll() {
      pity = 0;
      pityCount = 0;
      totalDraws = 0;
      recentSImages.length = 0;
      for (const key in stats) stats[key] = 0;
      document.getElementById("result").textContent = "";
      updateProgress();
      updateStats();
      updateDisplay();
      updateRecentSImages();
    }
	
	// 計算稀有度機率總和函式
	function calcProbabilities() {
		const raritySums = {};
		for (const item of items) {
		  if (!raritySums[item.rarity]) raritySums[item.rarity] = 0;
		  raritySums[item.rarity] += item.probability;
		}
		return raritySums;
	}

	window.onload = () => {
		const probDiv = document.getElementById("probabilitiesList");
		probDiv.innerHTML = items.map(item => {
		  const rarity = item[2];
		  const name = item[0];
		  const prob = item[1];
		  const probPercent = (prob * 100).toFixed(4);
		  return `<div>[${rarity}] ${name}：${probPercent}%</div>`;
		}).join("");
	}
  </script>
</body>
</html>
